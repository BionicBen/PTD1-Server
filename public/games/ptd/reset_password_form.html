<!DOCTYPE html>
<html lang="en">
<head>
    <title>Forgot Password</title>
    <meta charset="UTF-8">
    <link rel='stylesheet' type='text/css' href='../../_static/css/base.css'>
    <link rel='stylesheet' type='text/css' href='../../_static/css/suckerfish.css'>
    <link rel='stylesheet' type='text/css' href="../../_static/css/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous">
    </script>
    <script>
        $(function () {
            $("#header").load("/_static/html/header.html");
            $("#nav").load("/_static/html/nav.html");

            $("#forgotPassword").submit(function (event) {
                $("#submitButton").prop('disabled', true);
                event.preventDefault();

                //Send the AJAX call to the server
                $.ajax({
                    //The URL to process the request
                    'url' : '/api/sendResetPasswordForm/',
                    //The type of request, also known as the "method" in HTML forms
                    //Can be 'GET' or 'POST'
                    'type' : 'POST',
                    //Any post-data/get-data parameters
                    //This is optional
                    'data' : {
                        'email' : $('#email').val(),
                    },
                    //The response from the server
                    'success' : function(data) {
                        //You can use any jQuery/JavaScript here!!!
                        console.log(data);

                        const result = document.getElementById('result');
                        result.className = 'error-msg msg';

                        let error = document.getElementById('error');

                        if(error === null) {
                            error = document.createElement('a');
                        }

                        error.id = 'error';

                        switch(data) {
                            case 'success':
                                result.className = 'success-msg msg';
                                error.text = 'Email sent successfully!';
                                break;
                            case '0':
                                error.text = 'Unknown error occurred while trying to send email';
                                break;
                            case '1':
                                error.text = 'Email field cannot be empty!';
                                break;
                            case '2':
                                error.text = 'Email must contain "@"';
                                break;
                            case '3':
                                error.text = 'Domain must have an mx record associated with it';
                                break;
                            case '4':
                                error.text = 'Email not in db';
                                break;
                            case '8':
                                error.text = 'Haha! Nice try!';
                                break;
                        }

                        if(data !== 'success') {
                            $("#submitButton").prop('disabled', false);
                        }

                        result.append(error);
                    }
                });
            })
        });
    </script>
</head>
<body>
<div id="header"></div>
<div id="content">
    <div id="nav"></div>
    <table id="content_table">
        <tbody>
        <tr>
            <td id="sidebar">
                <div class="block">
                    <div id="result" class=""></div>
                    <div class="title">
                        <p>Forgot Password</p>
                    </div>
                    <div class="content">
                        <p>Please enter your email below to get an email to reset your password!</p>
                        <form id="forgotPassword">
                            <br>
                            <label><b>Email:</b>
                                <input id="email" class="text" name="email" type="text">
                            </label>
                            <br>
                            <br>
                            <div class="login_actions">
                                <input id="submitButton" value="Send" type="submit" class="login_btn">
                            </div>
                        </form>
                    </div>
                </div>
            </td>
            <td id="main">
                <div class="block">
                    <div class="title">
                        <p>Pok√©mon Tower Defense: Forgot Password</p>
                    </div>
                    <div class="content">
                        <p>So you forgot your password, it happens to the best of us but you're in luck, if you used an authentic email address (that you have access to) when making your account then you can reset your password with the link sent to your email!</p>
                    </div>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>